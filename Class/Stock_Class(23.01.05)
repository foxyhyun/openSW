{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "229ba77e",
   "metadata": {},
   "outputs": [],
   "source": [
    "from urllib import parse\n",
    "import pandas as pd\n",
    "import numpy as np\n",
    "import lxml\n",
    "import tensorflow as tf"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "935775dd",
   "metadata": {},
   "outputs": [],
   "source": [
    "def l2Norm(inp):# 환율데이터 표본적어서 *10\n",
    "    result = []\n",
    "    for i in inp:\n",
    "        result.append(((i-np.mean(inp))/np.var(inp))*10)\n",
    "    return result\n",
    "def l3Norm(inp):# *10안함\n",
    "    result = []\n",
    "    for i in inp:\n",
    "        result.append(((i-np.mean(inp))/np.var(inp)))\n",
    "    return result\n",
    "\n",
    "class Stock:\n",
    "    \n",
    "\n",
    "    \n",
    "    Exchange='./Exchange.csv' #객체가 공통으로 사용할 환율 데이터 (동적크롤링할줄몰라서 csv로 받아옴)\n",
    "    \n",
    "    def __init__(self,code):\n",
    "        self.code=code\n",
    "    \n",
    "    @staticmethod\n",
    "    def exchangeRate():  ##1달간격의 환율의 종가데이터  1행배열 57요소( 18.05.01~  23.01.01) 배열로 출력 SIZE(1,57)\n",
    "        csv = pd.read_csv(Stock.Exchange,encoding='utf-8')\n",
    "        #print(csv)  환율 전체데이터 확인하기            \n",
    "        csv = np.array(csv)\n",
    "        data=[]\n",
    "        for i in range(len(csv)):   \n",
    "            fnum=\"\"\n",
    "            for j in csv[i][1]:\n",
    "                if(j == ','):\n",
    "                    continue\n",
    "                fnum+=j\n",
    "            data.append(float(fnum))\n",
    "        data = np.array(data)\n",
    "        #정규화\n",
    "        data = data.astype('float32')\n",
    "        data = l2Norm(data) \n",
    "        return data\n",
    "\n",
    "    def idxNorm(self):##ROA, ROE, EPS, BPS, DPS, PER, PBR의 각 항목당 (2018.12 ~ 2023.12)의 데이터 6개 갖음 SIZE(7,8)\n",
    "        get_param = {\n",
    "            'pGB':1,\n",
    "            'gicode':'A%s'%(self.code),\n",
    "            'cID':'',\n",
    "            'MenuYn':'Y',\n",
    "            'ReportGB':'',\n",
    "            'NewMenuID':101,\n",
    "            'stkGb':701,\n",
    "        }\n",
    "        get_param = parse.urlencode(get_param)\n",
    "        url=\"http://comp.fnguide.com/SVO2/ASP/SVD_Main.asp?%s\"%(get_param)\n",
    "        tables = pd.read_html(url, header=0,encoding='utf-8')\n",
    "        sit=np.array(tables[11]) \n",
    "        \n",
    "        data=[]#정규화 시작\n",
    "        idx=np.array([])\n",
    "        for i in range(7):\n",
    "            idx = sit[17+i][2:8].astype('float32')\n",
    "            idx =l3Norm(idx)\n",
    "            data.append(idx)\n",
    "        data=np.array(data)\n",
    "        return data\n",
    "    \n",
    "    ##def priceList(self): ## 주식 종가를 데이터로 받아옴\n",
    "    \n",
    "    ##연비 구현바람\n",
    "    \n",
    "    \n",
    "    ##return \n",
    "\n",
    "\n",
    "    def showChart(self): ##종목코드의 제무재표를 나타내는 함수\n",
    "        get_param = {\n",
    "            'pGB':1,\n",
    "            'gicode':'A%s'%(self.code),\n",
    "            'cID':'',\n",
    "            'MenuYn':'Y',\n",
    "            'ReportGB':'',\n",
    "            'NewMenuID':101,\n",
    "            'stkGb':701,\n",
    "        }\n",
    "        get_param = parse.urlencode(get_param)\n",
    "        url=\"http://comp.fnguide.com/SVO2/ASP/SVD_Main.asp?%s\"%(get_param)\n",
    "        tables = pd.read_html(url, header=0,encoding='utf-8')\n",
    "        return tables[11]\n",
    "    "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "8d5af7ec",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "정규화 환율\n",
      " [0.15273633413016796, 0.13651004992425442, 0.2095378376543522, 0.4321892186999321, 0.457523949444294, 0.2804318815469742, 0.21190447732806206, 0.18418516963720322, 0.10305309668183327, 0.1402932032942772, 0.05268852226436138, 0.027497154660522938, 0.03558348398655653, 0.005694530555047095, -0.0037185821565799415, -0.018492669332772493, -0.0009932270040735602, -0.04671406000852585, -0.05983853247016668, -0.09736557491123676, -0.14021769165992737, -0.12124788947403431, -0.10330020450055599, -0.10918120853602886, -0.12038729153573513, -0.17986031249165535, -0.13530495576560497, -0.08658978156745434, -0.0360995763912797, 0.005658636218868196, 0.015788981691002846, 0.02599111758172512, 0.08374273777008057, 0.0504829827696085, 0.06009351462125778, 0.0276405131444335, 0.018263295060023665, -0.055069378577172756, -0.007322477176785469, -0.027869888581335545, 0.023857364431023598, 0.04431525710970163, 0.004547000862658024, -0.05272048059850931, 0.005407812423072755, -0.038609784096479416, -0.08728906512260437, -0.10790826752781868, -0.1315754372626543, -0.1281687431037426, -0.11716007255017757, -0.07846755906939507, -0.13412153348326683, -0.12429607100784779, -0.13005144894123077, -0.12707505375146866, -0.1886100322008133] \n",
      "\n",
      "정규화 지표값\n",
      " [[ 6.57189190e-01 -2.60525614e-01 -1.45051599e-01  1.81922317e-01\n",
      "  -1.49913253e-02 -4.18542773e-01]\n",
      " [ 4.55394328e-01 -1.78853080e-01 -1.03485465e-01  1.24356642e-01\n",
      "  -1.07253045e-02 -2.86686718e-01]\n",
      " [ 1.06780406e-03 -1.05936907e-03 -5.56975137e-04  8.83965113e-04\n",
      "   5.58711588e-04 -8.94137309e-04]\n",
      " [-2.26860866e-04 -1.57717688e-04 -9.83165446e-05  3.46876077e-05\n",
      "   1.91509156e-04  2.56698579e-04]\n",
      " [-9.33295174e-04 -9.33295174e-04  3.90064344e-03 -8.47521878e-04\n",
      "  -6.11645286e-04 -5.74885285e-04]\n",
      " [-3.44496071e-01  1.37726754e-01  2.86566317e-01 -3.77833918e-02\n",
      "  -1.55220374e-01  1.13206960e-01]\n",
      " [-2.79010201e+00  2.04778910e-01  4.58191204e+00  2.58532500e+00\n",
      "  -2.09897542e+00 -2.48293495e+00]] \n",
      "\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>IFRS(연결)</th>\n",
       "      <th>Annual</th>\n",
       "      <th>Annual.1</th>\n",
       "      <th>Annual.2</th>\n",
       "      <th>Annual.3</th>\n",
       "      <th>Annual.4</th>\n",
       "      <th>Annual.5</th>\n",
       "      <th>Annual.6</th>\n",
       "      <th>Annual.7</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>IFRS(연결)</td>\n",
       "      <td>2017/12</td>\n",
       "      <td>2018/12</td>\n",
       "      <td>2019/12</td>\n",
       "      <td>2020/12</td>\n",
       "      <td>2021/12</td>\n",
       "      <td>2022/12(E)</td>\n",
       "      <td>2023/12(E)</td>\n",
       "      <td>2024/12(E)</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>매출액</td>\n",
       "      <td>2395754</td>\n",
       "      <td>2437714</td>\n",
       "      <td>2304009</td>\n",
       "      <td>2368070</td>\n",
       "      <td>2796048</td>\n",
       "      <td>3047510</td>\n",
       "      <td>2922046</td>\n",
       "      <td>3141446</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>영업이익</td>\n",
       "      <td>536450</td>\n",
       "      <td>588867</td>\n",
       "      <td>277685</td>\n",
       "      <td>359939</td>\n",
       "      <td>516339</td>\n",
       "      <td>460303</td>\n",
       "      <td>286580</td>\n",
       "      <td>442425</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>영업이익(발표기준)</td>\n",
       "      <td>536450</td>\n",
       "      <td>588867</td>\n",
       "      <td>277685</td>\n",
       "      <td>359939</td>\n",
       "      <td>516339</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>당기순이익</td>\n",
       "      <td>421867</td>\n",
       "      <td>443449</td>\n",
       "      <td>217389</td>\n",
       "      <td>264078</td>\n",
       "      <td>399075</td>\n",
       "      <td>368730</td>\n",
       "      <td>234123</td>\n",
       "      <td>352284</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>지배주주순이익</td>\n",
       "      <td>413446</td>\n",
       "      <td>438909</td>\n",
       "      <td>215051</td>\n",
       "      <td>260908</td>\n",
       "      <td>392438</td>\n",
       "      <td>362731</td>\n",
       "      <td>230103</td>\n",
       "      <td>346471</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>비지배주주순이익</td>\n",
       "      <td>8422</td>\n",
       "      <td>4540</td>\n",
       "      <td>2338</td>\n",
       "      <td>3170</td>\n",
       "      <td>6637</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>자산총계</td>\n",
       "      <td>3017521</td>\n",
       "      <td>3393572</td>\n",
       "      <td>3525645</td>\n",
       "      <td>3782357</td>\n",
       "      <td>4266212</td>\n",
       "      <td>4615501</td>\n",
       "      <td>4787539</td>\n",
       "      <td>5149443</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>부채총계</td>\n",
       "      <td>872607</td>\n",
       "      <td>916041</td>\n",
       "      <td>896841</td>\n",
       "      <td>1022877</td>\n",
       "      <td>1217212</td>\n",
       "      <td>1225326</td>\n",
       "      <td>1255294</td>\n",
       "      <td>1355635</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>자본총계</td>\n",
       "      <td>2144914</td>\n",
       "      <td>2477532</td>\n",
       "      <td>2628804</td>\n",
       "      <td>2759480</td>\n",
       "      <td>3048999</td>\n",
       "      <td>3390175</td>\n",
       "      <td>3532246</td>\n",
       "      <td>3793809</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>지배주주지분</td>\n",
       "      <td>2072134</td>\n",
       "      <td>2400690</td>\n",
       "      <td>2549155</td>\n",
       "      <td>2676703</td>\n",
       "      <td>2962377</td>\n",
       "      <td>3299109</td>\n",
       "      <td>3439161</td>\n",
       "      <td>3695679</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>비지배주주지분</td>\n",
       "      <td>72780</td>\n",
       "      <td>76842</td>\n",
       "      <td>79649</td>\n",
       "      <td>82777</td>\n",
       "      <td>86622</td>\n",
       "      <td>91067</td>\n",
       "      <td>93085</td>\n",
       "      <td>98129</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>자본금</td>\n",
       "      <td>8975</td>\n",
       "      <td>8975</td>\n",
       "      <td>8975</td>\n",
       "      <td>8975</td>\n",
       "      <td>8975</td>\n",
       "      <td>8979</td>\n",
       "      <td>8979</td>\n",
       "      <td>8979</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>부채비율</td>\n",
       "      <td>40.68</td>\n",
       "      <td>36.97</td>\n",
       "      <td>34.12</td>\n",
       "      <td>37.07</td>\n",
       "      <td>39.92</td>\n",
       "      <td>36.14</td>\n",
       "      <td>35.54</td>\n",
       "      <td>35.73</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>유보율</td>\n",
       "      <td>23681.42</td>\n",
       "      <td>26648.22</td>\n",
       "      <td>28302.40</td>\n",
       "      <td>29723.53</td>\n",
       "      <td>32906.47</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>영업이익률</td>\n",
       "      <td>22.39</td>\n",
       "      <td>24.16</td>\n",
       "      <td>12.05</td>\n",
       "      <td>15.20</td>\n",
       "      <td>18.47</td>\n",
       "      <td>15.10</td>\n",
       "      <td>9.81</td>\n",
       "      <td>14.08</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>지배주주순이익률</td>\n",
       "      <td>17.26</td>\n",
       "      <td>18.00</td>\n",
       "      <td>9.33</td>\n",
       "      <td>11.02</td>\n",
       "      <td>14.04</td>\n",
       "      <td>11.90</td>\n",
       "      <td>7.87</td>\n",
       "      <td>11.03</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>ROA</td>\n",
       "      <td>14.96</td>\n",
       "      <td>13.83</td>\n",
       "      <td>6.28</td>\n",
       "      <td>7.23</td>\n",
       "      <td>9.92</td>\n",
       "      <td>8.30</td>\n",
       "      <td>4.98</td>\n",
       "      <td>7.09</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>ROE</td>\n",
       "      <td>21.01</td>\n",
       "      <td>19.63</td>\n",
       "      <td>8.69</td>\n",
       "      <td>9.99</td>\n",
       "      <td>13.92</td>\n",
       "      <td>11.59</td>\n",
       "      <td>6.83</td>\n",
       "      <td>9.71</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>EPS(원)</td>\n",
       "      <td>5421</td>\n",
       "      <td>6024</td>\n",
       "      <td>3166</td>\n",
       "      <td>3841</td>\n",
       "      <td>5777</td>\n",
       "      <td>5340</td>\n",
       "      <td>3388</td>\n",
       "      <td>5101</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20</th>\n",
       "      <td>BPS(원)</td>\n",
       "      <td>28971</td>\n",
       "      <td>35342</td>\n",
       "      <td>37528</td>\n",
       "      <td>39406</td>\n",
       "      <td>43611</td>\n",
       "      <td>48569</td>\n",
       "      <td>50630</td>\n",
       "      <td>54407</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21</th>\n",
       "      <td>DPS(원)</td>\n",
       "      <td>850</td>\n",
       "      <td>1416</td>\n",
       "      <td>1416</td>\n",
       "      <td>2994</td>\n",
       "      <td>1444</td>\n",
       "      <td>1521</td>\n",
       "      <td>1533</td>\n",
       "      <td>1526</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>22</th>\n",
       "      <td>PER</td>\n",
       "      <td>9.40</td>\n",
       "      <td>6.42</td>\n",
       "      <td>17.63</td>\n",
       "      <td>21.09</td>\n",
       "      <td>13.55</td>\n",
       "      <td>10.82</td>\n",
       "      <td>17.06</td>\n",
       "      <td>11.33</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>23</th>\n",
       "      <td>PBR</td>\n",
       "      <td>1.76</td>\n",
       "      <td>1.10</td>\n",
       "      <td>1.49</td>\n",
       "      <td>2.06</td>\n",
       "      <td>1.80</td>\n",
       "      <td>1.19</td>\n",
       "      <td>1.14</td>\n",
       "      <td>1.06</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>24</th>\n",
       "      <td>발행주식수</td>\n",
       "      <td>6454925</td>\n",
       "      <td>5969783</td>\n",
       "      <td>5969783</td>\n",
       "      <td>5969783</td>\n",
       "      <td>5969783</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>25</th>\n",
       "      <td>배당수익률</td>\n",
       "      <td>1.67</td>\n",
       "      <td>3.66</td>\n",
       "      <td>2.54</td>\n",
       "      <td>3.70</td>\n",
       "      <td>1.84</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "      IFRS(연결)    Annual  Annual.1  Annual.2  Annual.3  Annual.4    Annual.5  \\\n",
       "0     IFRS(연결)   2017/12   2018/12   2019/12   2020/12   2021/12  2022/12(E)   \n",
       "1          매출액   2395754   2437714   2304009   2368070   2796048     3047510   \n",
       "2         영업이익    536450    588867    277685    359939    516339      460303   \n",
       "3   영업이익(발표기준)    536450    588867    277685    359939    516339         NaN   \n",
       "4        당기순이익    421867    443449    217389    264078    399075      368730   \n",
       "5      지배주주순이익    413446    438909    215051    260908    392438      362731   \n",
       "6     비지배주주순이익      8422      4540      2338      3170      6637         NaN   \n",
       "7         자산총계   3017521   3393572   3525645   3782357   4266212     4615501   \n",
       "8         부채총계    872607    916041    896841   1022877   1217212     1225326   \n",
       "9         자본총계   2144914   2477532   2628804   2759480   3048999     3390175   \n",
       "10      지배주주지분   2072134   2400690   2549155   2676703   2962377     3299109   \n",
       "11     비지배주주지분     72780     76842     79649     82777     86622       91067   \n",
       "12         자본금      8975      8975      8975      8975      8975        8979   \n",
       "13        부채비율     40.68     36.97     34.12     37.07     39.92       36.14   \n",
       "14         유보율  23681.42  26648.22  28302.40  29723.53  32906.47         NaN   \n",
       "15       영업이익률     22.39     24.16     12.05     15.20     18.47       15.10   \n",
       "16    지배주주순이익률     17.26     18.00      9.33     11.02     14.04       11.90   \n",
       "17         ROA     14.96     13.83      6.28      7.23      9.92        8.30   \n",
       "18         ROE     21.01     19.63      8.69      9.99     13.92       11.59   \n",
       "19      EPS(원)      5421      6024      3166      3841      5777        5340   \n",
       "20      BPS(원)     28971     35342     37528     39406     43611       48569   \n",
       "21      DPS(원)       850      1416      1416      2994      1444        1521   \n",
       "22         PER      9.40      6.42     17.63     21.09     13.55       10.82   \n",
       "23         PBR      1.76      1.10      1.49      2.06      1.80        1.19   \n",
       "24       발행주식수   6454925   5969783   5969783   5969783   5969783         NaN   \n",
       "25       배당수익률      1.67      3.66      2.54      3.70      1.84         NaN   \n",
       "\n",
       "      Annual.6    Annual.7  \n",
       "0   2023/12(E)  2024/12(E)  \n",
       "1      2922046     3141446  \n",
       "2       286580      442425  \n",
       "3          NaN         NaN  \n",
       "4       234123      352284  \n",
       "5       230103      346471  \n",
       "6          NaN         NaN  \n",
       "7      4787539     5149443  \n",
       "8      1255294     1355635  \n",
       "9      3532246     3793809  \n",
       "10     3439161     3695679  \n",
       "11       93085       98129  \n",
       "12        8979        8979  \n",
       "13       35.54       35.73  \n",
       "14         NaN         NaN  \n",
       "15        9.81       14.08  \n",
       "16        7.87       11.03  \n",
       "17        4.98        7.09  \n",
       "18        6.83        9.71  \n",
       "19        3388        5101  \n",
       "20       50630       54407  \n",
       "21        1533        1526  \n",
       "22       17.06       11.33  \n",
       "23        1.14        1.06  \n",
       "24         NaN         NaN  \n",
       "25         NaN         NaN  "
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "SS = Stock('005930')\n",
    "#SK = Stock('000660')\n",
    "#DW=Stock('049770')\n",
    "#SFA=Stock('056190')\n",
    "#GW=Stock('001570')\n",
    "\n",
    "print('정규화 환율\\n',Stock.exchangeRate(),'\\n') #환율 나타내기\n",
    "print('정규화 지표값\\n',SS.idxNorm(),'\\n') #지표값 정규화\n",
    "SS.showChart() #삼성재무재표 바로보기"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "b9d16770",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.2"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
